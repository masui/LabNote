<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>コロンブス日和 - 古いページ</title>
    <style type="text/css">
      body {
        background-color:#ffffff;
        font-size:12;
        font-family: "Hiragino Kaku Gothic ProN","メイリオ", "sans-serif";
      }
      a Gear text-decoration: none; }
      li.bold { font-weight: bold; }
      div.body { width:340pt; }
      div.left { float:left; width:10%; font-weight:bold;}
      div.right { width:50%;}
      h1 { background-color:#4d4; padding:8pt;}
      code { background-color:#eee; }
      pre { background-color:#eee; }
    </style>
    <script type="text/javascript">
    //setTimeout("location.reload()",1000*5);
    </script>
  </head>

  <body>
    <div class='body'>
      <h1>コロンブス日和 - 古さの視覚化</h1>

      <!--
      <h2>ファイルの中身の古さの視覚化</h2>

      昔から使っているプログラムを修正するとき、
      長年利用していた部分はある程度枯れていて正しい可能性が高いですが
      新しく追加した部分はバグを含んでいる可能性が古い部分よりも高いと考えられます。
      そのような場合、
      プログラミング作業中は新しい部分により注意する必要があるでしょう。

      バージョン管理システムをうまく使えば
      古い部分と新しい部分を知ることはできますが、
      古さを意識しながらテキストエディタを使うことはありませんから
      実際そういう意識を持つことは困難です。

      文書やプログラムの一部を編集したとき、
      どの部分を編集したのかわかると良いかもしれません。

      <p/>
      プログラムの更新履歴や新しさを
      行単位で把握しやすくするためのシステムが提案されています。

      以下の図は
      AT&amp;Tの研究所で開発された
      Seesoftというシステムで、
      プログラムのソースコードの各行の長さや編集履歴が色で表示されるようになっているものです。
      
      <blockquote>
	<img src="https://gyazo.com/b88beeb9ddd151b30d6b35d1bc95b9d0.png" height=200>
      </blockquote>

      縦長の矩形はソースファイルを表現しており、
      行の古さや更新履歴が色で表現されています。

      このように古さを意識しながプログラミングを行なうようにすれば、
      間違って正しい部分を壊ししまうような可能性が低くなるでしょう

      <h2>ファイルの古さの視覚化</h2>

      パソコンのファイルが古いかどうかは作成/更新日時で調べるのが普通です。

      Finderなどでファイルをリストするとき、
      作成時刻は表示されるものの、
      古さを実感として理解するのは難しいと思われます。

      古いファイルはアイコンが汚くなるような工夫があってもよさそうなものですが、
      ファイルの古さはあまり重要と考えられてないようで、
      そういうシステムは見たことがありません。

      -->

      <h2>Webページの古さの視覚化</h2>

      Webで面白いニュースをみつけたとき、
      よく見たらすごく古いページだということに気付いてがっかりすることがあります。
      がっかりするだけだとまだ良いのですが、
      SNSなどで紹介した後で古さを指摘されたりすると結構恥ずかしいものです。

      <p/>
      世の中の大抵のものは古くなると
      ゴミが溜まったり変色したりするものなので、
      古さになんとなく気付くのが普通ですが、
      ファイルやWebページは古くなっても見栄えが変わらないため
      こういう失敗をしやすいといえるでしょう。
      
      デジタルデータは劣化しないことが大きな特徴なのですが、
      古さが直感的にわかった方が

      <p/>
      古くても価値が変わらない情報ならまだ良いのですが、
      ニュースや技術情報のように
      新しさが重要なものは、
      間違って古いページを参照しないように気をつけなければなりません。

      <p/>
      今回は
      Webページの古さを直感的に理解するための工夫をいくつか紹介したいと思います。

      <h3>廃れるリンク</h3>

      はこだて未来大学の塚田浩二氏は、
      古いページへのリンクが汚く見える
      <a href="廃れるリンク">http://mobiquitous.com/dying-link.html</a>
      というシステムを開発しました。

      以下のようなWebページがあるとき、
      
      <blockquote>
	<img src="http://mobiquitous.com/image/dying-1-1-mini.png">
      </blockquote>

      廃れるリンクシステムを適用すると
      以下のようにリンク文字列が汚く表示され、
      リンク先のページが古いことがわかるというものです。
      
      <blockquote>
	<img src="http://mobiquitous.com/image/dying-1-2-mini.png">
      </blockquote>

      廃れるリンクシステムはプロキシサーバで実装されていました。
      
      <h3>廃れるバックグラウンド</h3>

      リンク先が古いことがわかるのは良いのですが、
      ページ自体も古く見えて欲しいものでしょう。

      自分のWebページの場合、作成時刻や編集時刻がはっきりわかりますから
      きめ細かく古さを表示することができます。

      以下の図は私がかなり前に作成した
      「廃れるバックグラウンド」というシステムで、
      各部分のアクセス状況によってバックグラウンド表示を変えています。

      <blockquote>
	<img src="https://gyazo.com/1074835f61567eccdf16e6e320d43867.png">
      </blockquote>

      <blockquote>
	<img src="https://gyazo.com/931f21f90e68b1f1ad66662fc238561c.png">
	</blockquote>
      
      <blockquote>
	<img src="https://gyazo.com/11540aff4e009130bba7a5b0a2ceb75e.png">
      </blockquote>

      <blockquote>
	<img src="https://gyazo.com/7be2199f5fa5338a30f8a85a24fb3872.png">
      </blockquote>

      廃れるバックグラウンドを採用したWikiでは
      自力でバックグラウンド画像を作成しているので
      ブラウザの設定を変えたりする必要はありません。
      
      <h3>ブラウザ拡張機能による古さの視覚化</h3>

      廃れるリンクも廃れるバックグラウンドは10年以上に作成したシステムで、
      手間の割に便利さが足りなく思われたり
      見栄えがイマイチだったりするために
      日常的に使ってはいませんでした。

      <p/>
      一方、Web上の情報がますます増えてきた現在、
      古い情報を新しいものと勘違いする危険は増えているような気がしますし、
      最近のChromeやFirefoxはブラウザ拡張機能を簡単に作れるようになってきたので
      古さの表示に再挑戦してみることにしました。

      方針は以下のとおりです。

      <ul>
	<li>ブラウザ拡張機能として実装</li>
	<li>古いページを表示するときは最初の数秒だけそのことを表示する</li>
      </ul>

      従来はブラウザ拡張機能を作るのはかなり大変でしたが、
      最近はFirefoxでもChromeでも同じ型式で開発が可能ですし、
      開発の手間もかなり小さくなっています。

      ブラウザにちょっとした機能をJavaScriptで追加したいとき、
      以前はGreasemonkeyという拡張機能がよく利用されていましたが、
      最近はブラウザ拡張機能を直接JavaScriptで簡単に作成できるようになったので
      気軽にブラウザ拡張機能を作って使うのが良い気がしています。

      <h4>廃れの実装</h4>

      廃れ機能の原理はとても簡単で、

      <ol>
	<li>Webページの時刻を取得する</li>
	<li>古い場合は全画面を古い感じにして古さを表示する</li>
      </ol>

      というだけです。
      2.については「廃れるバックグラウンド」で利用していたような画像を
      &lt;div&gt;で重ねるだけなので簡単ですが、
      時刻を取得するのは少し注意が必要です。

      <p/>
      Webページの作成時刻は<code>document.lastModified</code>で取得できるはずなのですが、
      これがうまく取得できない場合があります。
      また、動的に生成されるページでは現在時刻が設定されてしまう場合があります。
      私は<code>masui.blog.jp</code>というアドレスで時々ブログを書いているのですが、
      ブログ記事ページの作成時刻は常にに現在時刻になってしまい、
      記事内容が古くてもページの作成時刻は


      <h3>ブラウザ拡張機能の開発について</h3>
      <h3>ブックマークレット、Greasemonkey、ブラウザ拡張機能、...</h3>

      <!--
      http://oxynotes.com/?p=9070 Firefix拡張機能開発の歴史
       - Chrome XUL
      - add-on SDK cfxコマンドベース
      - jpm node.jsベース
      - web-ext
	-->

      各種のブラウザ拡張機能を使っている人は多いでしょうが
      自分で作って活用している人は少ないと思います。
      
      ブラウザの拡張機能を作る方法はブラウザごとに異なっていましたし、
      APIが膨大で理解が大変ですし、
      作成方法がしょっちゅう変わるので対応が大変だったりしたものです。

      <p/>
      たとえばFirefoxの場合、

      <ul>
	<li>Chrome XULを利用して開発</li>
	<li>Pythonベースの(?)cfxコマンドでadd-on SDKを利用して開発</li>
	<li>Node.jsベースのjpmコマンドでadd-on SDKを利用して開発</li>
	<li>Web-extコマンドで開発</li>
      </ul>

      のように開発方法が変化してきたため、
      数年前のページは全く役にたたない可能性が高く、
      今回紹介したようなシステムが有効な典型的な例な気がします。

      <p/>
      「ブラウザ拡張」というのは
      ブラウザのあらゆる機能を拡張するものですから、
      ブラウザ(アプリ)の
      見栄えや動きを制御するための
      様々なAPIを利用する必要がありました。

      一方、
      Webページの
      見栄えや機能を変更したい場合は
      ページ内のHTMLやCSSを操作できれば良いわけですから
      jQueryで用意されているような
      普通のJavaScript APIを

      バックグラウンドを変更したい場合は
      条件に応じてbodyの背景画像やCSSを変更できればいいことになります。

      <p/>
      このような目的のためには
      ブックマークレットがよく利用されていますが、
      自動的になんらかの処理を行ないたい場合は
      Greasemonkeyというシステムが従来よく利用されていました。
      
      GreasemonkeyはFirefoxの拡張機能で、
      ユーザが登録したJavaScriptコードを拡張機能のように利用できるというものでした。

      私の場合、
      拡張機能のAPIを勉強するのは面倒だけれど
      自動的にWebページを操作したいことは多かったので、
      Greasemonkeyをよく利用していました。

      たとえば、
      パスワードを要求するWebサービスに対して
      EpisoPassのような
      「なぞなぞ認証」でログインを可能にするような
      Greasemonkeyスクリプトを作って使ったりしていました。

      <p/>
      しかし最近は事情が若干改善しており、
      それほど苦労しなくても
      JavaScriptで拡張機能を作成できるようになってきたので、
      Greasemonkeyを使う必然性は無くなったといえるでしょう。

      実は最近
      EpisoPassを使える
      拡張機能を作って使っていますが
      すこぶる便利です。

      こういう状況なので、現状では
      廃れるページは
      ブラウザ拡張機能として実装するのが良いと思われます。

      <p/>
      現在見ているWebページに対する処理を指定できる
      ブックマークレットというのは便利な仕組みなのですが、
      そもそもWebページのURLを記憶するためのブックマーク機能を
      Webページの操作に利用するというのはわかりにくいですし、
      登録も起動も簡単ではないので
      世の中で広く使われるようにはなっていないようです。

      別のWebページにジャンプする
      のと
      今見ているWebページに手を加える
      のは
      かなり意識が異なり、同列に扱うことは難しい気がします。
      
      
      一方、
      ブラウザ拡張機能というのは
      ブラウザの見栄えや挙動を変えるというはっきりした意図が明らかですし、
      インストールや管理も簡単なので、
      そういう用途にはこちらの方が向いていると思われます。

      ブラウザ拡張機能の作成が簡単になってきた現在、
      もっと様々なブラウザ拡張機能が出現してもいいでしょう。

      <h3>Web-extによるブラウザ拡張機能の開発</h3>

      Web-extは最近使えるようなったもので、
      FirefoxでもChromeでも使える

      <p/>
      <hr>
      <p/>
      
      廃れるリンクも廃れるバックグラウンドも
      色々用意が必要な割に効果があまり劇的でないせいか、
      提案後流行するということがありませんでした。

      しかしブラウザ拡張機能を使ったものは
      インストールが簡単ですし、
      実際古いページかどうかがすぐにわかるので
      今のところ満足して利用しています。

      古い古いと表示されるのはウザいこともあるでしょうが、
      数秒待てば完全に消えてしまいますし、
      実際古いページにアクセスする機会はそれほど多いわけではありませんから
      なんとか便利さとウザさのトレードオフが
      我慢できるレベルになっている気がします



      信用できない記事を書くことで有名な人物の署名記事に警告を出すとか、
      嫌いな人や物の記事を消してしまうとか、

      https://gyazo.com/add26bf82bca1d66876c72c31426607c コケ 壁
      
            
    </div>
  </body>
</html>


