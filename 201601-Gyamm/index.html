<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>コロンブス日和 - Gyamm</title>
    <style type="text/css">
      body { background-color: #eee; }
      a { text-decoration: none; }
      li { font-weight: bold; }
      div.body { width:400pt; }
    </style>
  </head>
  
  <body>
    <div class='body'>

      http://www.mew.org/~kazu/doc/newsletter/3.html
      Multipartということ
      
      <h1>コロンブス日和 - Gyamm</h1>
      
      前回「あらゆるものがURLで表現可能になりつつある」と言いましたが、
      何故かメールメッセージにアクセスするのにURLを使うのは一般的ではありません。
      
      GMailのようなWebメールサービスを使えばブラウザからメールメッセージを参照することができる場合もありますが、
      他人にURLを渡すことができません。

      たとえばパーティーの案内をメールで受け取ったとき、
      その内容をブラウザから参照することはできませんからブックマーク
      ブラウザから使えるGMailのようなWebメールシステムを使っていればブックマークできますが、
      他人と共有することができないので不便です。

      <p/>
      メールとWebの相性がいまひとつなのは、

      <ul>
	<li>メールはWebより古くから存在し、独自の使われ方がある</li>
	<li>メールは主に個人的な情報のやりとりに使われることが多い</li>
      </ul>

      という事情のため融合方式があまり考えられていないからだと思います。

      一方、Facebookなどでは
      公開情報も個人メッセージもひとつのシステムで扱うことができるので便利だといえます。

      メールメッセージを普通のWebページのように扱うことができれば
      メールのやりとりは現在よりずっと簡単になります。

      <h2>Gyamm - メールメッセージをWebページ化する</h2>

      GyammはメールメッセージをWebページに変換するシステムです。
      GMailのようなWebメールシステムと異なり、
      変換されたページは普通のHTMLのページになるので
      誰からでも見ることができます

      使い方は簡単で、
      メッセージを
      <code>xxxxx@gyamm.com</code>
      に送るだけです。
      送られたメッセージは
      <code>http://gyamm.com/xxxxx</code>
      で閲覧することができます。
      HTMLメールや添付ファイルを含むメールも
      Webページとして閲覧することができます。

      <h2>Gyammの利用例</h2>

      Gyammは以下のような用途に利用できます。

      <ul>
	<li>単体で公開</li>
	
	HTMLメールをブラウザで読める
	
	<li>メールのアーカイブ</li>
	
	xxxx-archive@gyamm.com のようなアドレスをメーリングリストのメンバに登録してメッセージをアーカイブする

	<li>イベントや宴会の案内メールをブラウザで読めるようにする</li>
    
	<li>Togetterのように関連メールをまとめる</li>
	
	<li>アンケートやレポートをメールで集計する</li>

	同じアドレスに送ってもらうとひとつのページにまとまる

	<li>TODO情報をまとめておく</li>

	<li>メールで送られてきた地図にブラウザからアクセスする</li>
	
	<li>自分が受け取ったメルマガ記事を保存する</li>
	
	<li>ネットサービスからの返信を保存する</li>

	フォルダみたいなののかわりに使う
	どこからでもアクセスできるので便利
      </ul>

      <h2>Gyammの実装</h2>

      このようにGyammの使い方はとても簡単ですが、
      実装はちょっと面倒です。

      <ol>
	<li>SMTPと同じ動作をするGyammサーバをgyamm.comで動かす</li>
	<li>そこに届いたメッセージを解析してHTMLファイルに変換する</li>
      </ol>

      <h3>SMTPサーバの実装</h3>

      Gyamm.comに対してメールを送れるようにするためにSMTPサーバを動かしています。
      SMTPの仕様はRFCxxxxで定義されています。

      SMTPサーバは以下のような動作をします。

      <blockquote>
	<pre>
	  % telnet gyamm.com 25
	  HELO
	  FROM
	</pre>
      </blockquote>

      <p/>
      本当のSMTPサーバはメール転送などの処理をする必要がありますが、
      Gyammサーバはメールを受け取るだけなので、
      data
      で送られてきたメッセージを解析して
      HTMLに変換すればよいので
      実装はそれほど難しくありません。

      <h3>メールをHTMLに変換</h3>

      Gyammサーバで受け取ったメールをWebサーバで読める形のHTMLファイルに変換するためには
      以下の処理が必要です。

      <ul>
	<li>ヘッダのデコード</li>
	<li>MIMEパートの分離</li>
	<li>MIMEパートのデコード</li>
	<li>埋め込み画像の変換</li>
      </ul>
      
      現在はメールのSubject(タイトル)に日本語を利用したり
      画像や文書などをメールに添付するのはあたりまえになっていますが、
      もともとのメールの規格では
      タイトルも本文もASCII文字しか利用することができないことになっていました。

      インターネットの黎明時代には
      メールの本文にJISコードを利用することにより
      なんとか日本語のメッセージを送ることはできましたが、
      正式な規格からははずれていましたし、

      一方、パソコン通信などの非インターネットの世界では
      タイトルや本文にShiftJISの日本語が利用されていることが多く、
      かなり混沌とした状態になっていました。
      
      <h4>MIMEについて</h4>
      
      1990年ごろまではそういう状況が続いていたのですが、
      1992に
      CMUのNathaniel S. Borensteinらによって
      MIME規格がRFCxxxxとして制定されたおかげで
      任意の言語をタイトルや本文に利用したり、
      メッセージにファイルを含めたりできるようになりました。

      既存んメール配信システムを変更することなくデータをマルチメディア化するため、
      MIMEでは以下のような方法によって
      様々なデータをメールメッセージとして送れるようになっています。

      <ul>
	<li>データ型の指定</li>
	Content-Type:フィールドでデータ型や文字コードを正確に指定する
	<li>データのエンコード</li>
	画像や文書など任意のデータをテキスト型式に変換する方法を定義
	<li>データの階層な構造化</li>
	マルチパートというデータ型を使って、複数のデータをまとめて扱えるようにしました
	複数パートをまとめたデータ全体を、ひとつ上位の一部分とすることもえきるので
	階層的なデータ構造を表現できます。
	<li>ヘッダの国際化</li>
	任意の文字コードの文字列をヘッダで利用できるエンコード方式を定義
      </ul>

      HTMLファイルや画像ファイルは上の方法で
      パートに分けてMIMEメッセージにすることができますが、
      画像を含むWebページのHTMLと画像をまとめてMIME化したいときのために、
      通常のimgタグのかわりに
      MIME内の別パートの画像を参照する特殊なimgタグを利用することにより、
      画像を含むWebページをひとつのHTMLメールとしてMIMEエンコードすることができるようにもなっています。

      <h4>MIMEのデコード</h4>

      Gyaimでは
      MIME型式で送られてきたメールをデコードして、
      人間が読める形に変換しています。
      テキストは普通のHTMLテキストに変換し、
      それ以外のものは添付ファイルとしてリストするようにしています。
      
    </div>
  </body>
</html>

最近はあらゆる情報にURLがついています。 製品にも本にも日記にもレシピに
も場所にも人間にもURLがついており、 あらゆる情報へのポインタがURLで表
現できる時代になってきたといえるでしょう。

ところが何故かメールにはURLがついていません。 メールは個人的なものだか
らあたりまえだと思われているかもしれませんが、考えてみると不便な話です。
会議やイベントの連絡がメールで送られてきたとき、その情報を表現するURL
がありませんから、 別の場所からその情報にリンクを張ることができません。
面白い情報をメールで貰ったとき、それを他人に伝えようとするとメールの転
送が必要で、 そのようなデータにブラウザからアクセスできないのは不思議
な話です。 あらゆる情報の中でメール情報だけが別の世界にいるかのようで
す。

GyazzのようなWikiは便利なのですが、 メールでもらったデータにリンクを張
ることができないのが困りものでした。 メールで貰ったイベントの案内を
Wikiに書きたいと思ったとき、 メールにリンクを張ることはできませんから
イベントのページを捜すのですが、 何でもWebページが有るとは限りません。
会議の連絡や宴会の連絡がメールで来るのは日常茶飯事ですが、 会議のペー
ジや宴会のページなどはありませんからリンクを張ることは不可能ですし、
URLが無いとブックマークすることもできません。

メールで届いた情報を参照する場合、メールソフトを利用するか、 メールの
内容を別の場所にコピペしておいて参照するのが普通です。 また、こういっ
た不具合を解決するため、 メールも文書も同じように扱えることを売りにし
たソフトが色々開発されていますが、 メールが別世界にいるという状況は変
わりません。 文書などのデータはそのまま普通にWebで公開できるのに対し、
メールを公開するにはコピペなどのデータ変換が必要になります。 そもそも
メールが同じ世界に存在して直接リンクを張ることができるのならばこういう
面倒は不要なはずです。 メールだけが別世界にいることが問題であり、 あら
ゆる情報をURLで一括管理できればメール情報の扱いの面倒さは解消するはず
です。 Gyammを利用すると、メールの世界に閉じこめられていた情報をURLの
世界に持ち出すことができます。

メールが開発されたのはWebが開発されるよりもずっと前のことなので、 別世
界の話なのは仕方がなかったかもしれません。 しかしWebが発明されて20年近
くたっている現在、 いつまでもメールを別世界のまま放っておくわけにはい
かないでしょう。 なんらかの方法での融合が必要だと思われますが、 そうい
う意識を高めるためにGyammは有用だろうと思われます。

(2011/5/4 増井俊之) 
