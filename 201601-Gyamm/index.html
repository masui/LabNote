<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>コロンブス日和 - Gyamm</title>
    <style type="text/css">
      body { background-color: #eee; }
      a { text-decoration: none; }
      li { font-weight: bold; }
      div.body { width:400pt; }
    </style>
  </head>
  
  <body>
    <div class='body'>

      http://www.mew.org/~kazu/doc/newsletter/3.html
      Multipartということ
      
      <h1>コロンブス日和 - Gyamm</h1>
      
      前回「あらゆるものがURLで表現可能になりつつある」と言いましたが、
      何故かメールメッセージにアクセスするのにURLを使うのは一般的ではありません。
      
      GMailのようなWebメールサービスを使えばブラウザからメールメッセージを参照することができる場合もありますが、
      他人にURLを渡すことができません。

      たとえばパーティーの案内をメールで受け取ったとき、
      その内容をブラウザから参照することはできませんからブックマーク
      ブラウザから使えるGMailのようなWebメールシステムを使っていればブックマークできますが、
      他人と共有することができないので不便です。

      <p/>
      メールとWebの相性がいまひとつなのは、

      <ul>
	<li>メールはWebより古くから存在し、独自の使われ方がある</li>
	<li>メールは主に個人的な情報のやりとりに使われることが多い</li>
      </ul>

      という事情のため融合方式があまり考えられていないからだと思います。

      一方、Facebookなどでは
      公開情報も個人メッセージもひとつのシステムで扱うことができるので便利だといえます。

      メールメッセージを普通のWebページのように扱うことができれば
      メールのやりとりは現在よりずっと簡単になります。

      <h2>Gyamm - メールメッセージをWebページ化する</h2>

      GyammはメールメッセージをWebページに変換するシステムです。
      GMailのようなWebメールシステムと異なり、
      変換されたページは普通のHTMLのページになるので
      誰からでも見ることができます

      使い方は簡単で、
      メッセージを
      <code>xxxxx@gyamm.com</code>
      に送るだけです。
      送られたメッセージは
      <code>http://gyamm.com/xxxxx</code>
      で閲覧することができます。
      HTMLメールや添付ファイルを含むメールも
      Webページとして閲覧することができます。

      <p/>

      <h2>Gyammの実装</h2>

      このようにGyammの使い方はとても簡単ですが、
      実装はちょっと面倒です。

      <ol>
	<li>SMTPと同じ動作をするGyammサーバをgyamm.comで動かす</li>
	<li>そこに届いたメッセージを解析してHTMLファイルに変換する</li>
      </ol>

      <h3>SMTPサーバの実装</h3>

      Gyamm.comに対してメールを送れるようにするためにSMTPサーバを動かしています。
      SMTPの仕様はRFCxxxxで定義されています。

      <h3>メールをHTMLに変換</h3>

      Gyammサーバで受け取ったメールをWebサーバで読める形のHTMLファイルに変換するためには
      以下の処理が必要です。

      <ul>
	<li>ヘッダなどのデコード</li>
	<li>MIMEパートの分離</li>
	<li>ファイルのデコード</li>
	<li>埋め込み画像の変換</li>
      </ul>
      
      現在はメールのSubject(タイトル)に日本語を利用したり
      画像や文書などをメールに添付するのはあたりまえになっていますが、
      もともとのメールの規格では
      タイトルも本文もASCII文字しか利用することができないことになっていました。

      インターネットの黎明時代には
      メールの本文にJISコードを利用することにより
      なんとか日本語のメッセージを送ることはできましたが、
      正式な規格からははずれていましたし、

      一方、パソコン通信などの非インターネットの世界では
      タイトルや本文にShiftJISの日本語が利用されていることが多く、
      かなり混沌とした状態になっていました。
      
      <h4>MIMEについて</h4>
      
      1990年ごろまではそういう状況が続いていたのですが、
      1992に
      CMUのNathaniel S. Borensteinらによって
      MIME規格がRFCxxxxとして制定されたおかげで
      任意の言語をタイトルや本文に利用したり、
      メッセージにファイルを含めたりできるようになりました。

      既存んメール配信システムを変更することなくデータをマルチメディア化するため、
      MIMEでは以下のような方法によって
      様々なデータをメールメッセージとして送れるようになっています。

      <ul>
	<li>データ型の指定</li>
	Content-Type:フィールドでデータ型や文字コードを正確に指定する
	<li>データのエンコード</li>
	画像や文書など任意のデータをテキスト型式に変換する方法を定義
	<li>データの階層な構造化</li>
	マルチパートというデータ型を使って、複数のデータをまとめて扱えるようにしました
	複数パートをまとめたデータ全体を、ひとつ上位の一部分とすることもえきるので
	階層的なデータ構造を表現できます。
	<li>ヘッダの国際化</li>
	任意の文字コードの文字列をヘッダで利用できるエンコード方式を定義
      </ul>

      HTMLファイルや画像ファイルは上の方法で
      パートに分けてMIMEメッセージにすることができますが、
      画像を含むWebページのHTMLと画像をまとめてMIME化したいときのために、
      通常のimgタグのかわりに
      MIME内の別パートの画像を参照する特殊なimgタグを利用することにより、
      画像を含むWebページをひとつのHTMLメールとしてMIMEエンコードすることができるようにもなっています。

      <h4>MIMEのデコード</h4>

      Gyaimでは
      MIME型式で送られてきたメールをデコードして、
      人間が読める形に変換しています。
      テキストは普通のHTMLテキストに変換し、
      それ以外のものは添付ファイルとしてリストするようにしています。
      
    </div>
  </body>
</html>
