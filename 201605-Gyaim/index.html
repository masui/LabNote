<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>コロンブス日和 - Dynamic Macro</title>
    <style type="text/css">
      body {
        background-color:#ffffff;
        font-size:12;
        font-family: "Hiragino Kaku Gothic ProN","メイリオ", "sans-serif";
      }
      a { text-decoration: none; }
      li.bold { font-weight: bold; }
      div.body { width:340pt; }
      div.left { float:left; width:10%; font-weight:bold;}
      div.right { width:50%;}
      h1 { background-color:#4d4; padding:8pt;}
    </style>
  </head>

  <body>
    <div class='body'>
      <h1>コロンブス日和 - Gyaim</h1>
      
      今回は「Gyaim」という日本語入力システムを紹介したいと思います。
      <br/>
      
      この連載は、シンプルなのに便利な
      「コロンブスの卵」的なシステムを紹介するものなのに
      日本語入力システムのような複雑なものを取り上げるのは変だと思うかもしれませんが、
      「Gyaim」は単純な原理にもとづいているにもかかわらず
      実用的に利用できるものなので
      紹介したいと思います。
      
      私はこの連載はすべてMac上のGyaimで書いています。
      
      <h2>日本語入力システムの歴史</h2>
      
      現在のパソコンでは
      「かな漢字変換システム」で日本語入力を行なうのが普通になっています。
      かな漢字変換システムは、
      <!-- 現在湘南工科大学教授の天野真家氏が -->
      1978年に東芝で開発されたワープロで初めて導入されたものですが、
      パソコンの黎明期から標準的に利用されてきています。
      
      かな漢字変換システム以外にも様々な日本語入力システムが提案されてきましたが、
      普通のユーザがすごい努力をしなくてもとりあえず使えるうえに
      効率的な入力も可能だという特長があるため
      読みをもとにして日本語を入力する手法が廃れることはなさそうです。
      <p/>
      
      現在のパソコンのかな漢字変換システムでは
      いわゆる「連文節変換」が主流になっています。
      連文節変換とは
      長い文章の読みを入力した後で
      漢字混じりの正しい日本語に変換するシステムのことで、
      たとえば
      「わたしのなまえはなかのです」
      という入力を
      「私の名前は中野です」
      
      
      日本語の文章中で「ネ」を挿入できる場所で区切ったものを
      「私のネ 名前はネ 中野です」
      
      日本語を文節ごとに入力するのは比較的簡単なので
      初期のパソコンでは文節ベースの日本語入力システムがよく使われてましたが、
      長い日本語文章を一気に漢字文字列に変換したいという人が多かったため、
      最近の日本語入力では連文節変換システムが主流になっています。
      
      連文節変換システムを使うと
      「わたしのなまえはなかのです」のような入力を一度に
      「私の名前は中野です」に変換することができます。
      
      連文節変換は一見便利そうですが、実は問題が多いと思っています。
      
      <ul>
        <li>正確な入力が必要</li>
        
        現在よく使われているほとんどの日本語入力システムでは、
        入力文字が1文字でも間違っていれば変換することができない。
        「ふいんき」を「雰囲気」に変換するようなシステムは存在するが、
        これは「雰囲気」を「ふいんき」という読みで登録しているだけであり、
        「ふんにき」を「雰囲気」に変換することはできない。
        
        <li>完全な読みの入力が必要</li>
        
        しながわえき
        
        <li>変換誤りの訂正が必須</li>
        
        例えば「きょうはいしゃにいった」は
        「今日は医者に行った」「今日歯医者に行った」のどちらに変換すべきなのか
        計算機が判断することは不可能である。
        
        <li>非力なマシンで使えない</li>
        
        正確な変換を行なうためには充分な計算パワーが必要であり、
        小型の計算機では充分な速度で正確な連文節変換を行なうことができない。

      </ul>
      
      これからのユビキタス社会社会においては、
      パソコン環境で熟練者にとってのみ使える入力手法ではなく、
      どこでも誰でも簡単に使えるシンプルで柔軟で効率良い入力方式が必要だと考えられる。

      <ul>
        <li>キーやボタンなどの数が少ない</li>
        <li>操作の種類が少ない</li>
        <li>入力に必要な操作量が少ない</li>
        <li>ユーザがカスタマイズ可能</li>
        <li>様々な環境で同じ方式が使える</li>
      </ul>
      
      このような要件を満たすためには、
      単純なアルゴリズムにもとづいて
      単純な操作で入力を行うシステムが良いと考えられます。
      
      <h2>SKK</h2>
      
      かな漢字変換システムには
      凄い自然言語処理が必要だと思っている人が多いかもしれません
      
      しかし基本的にかな漢字変換というのは
      かなまたはローマ字を漢字に変換するのは単純な作業であり、
      長い読みを正しい日本語に変換する「連文節変換」や
      動詞や形容詞の活用に対応することは
      
      要するに
      連文節変換を使うのをやめてしまえば
      日本語入力は簡単に実装できてしまうことになります。
      
      接続辞書
      
      単文節変換で面倒なのは
      動詞や形容詞の語尾の扱いが問題になります。
      
      
      <h3>SKK</h3>
      
      SKKは非常に単純な方法で単文節変換を実現した日本語入力システムで、
      以前はEmacs上でよく利用されていました。
      
      SKKで「歩く」と入力する場合、
      ユーザは「AruKu」のように大文字と小文字を混ぜたローマ字を入力します。
      SKKが日本語モードになっているとき、
      ユーザが「aruku」のように小文字を入力したときは「あるく」のような平仮名にすぐに変換されますが、
      大文字でローマ字を入力したときは
      かな漢字変換辞書を使って候補単語を選びます。
      
      また送り仮名がある場合は漢字部分(aru)と送り仮名部分(ku)の両方で大文字を利用することにより
      送り仮名処理を簡単にしています。
      一般的な入力システムで
      
      <h3>Gyaim</h3>
      
      私は1990年ごろはSKKを愛用していたのですが、
      POBoxの開発後はあらゆる計算機でPOBoxを使っています。
      
      SKKは単純な仕組みで効率的な日本語入力ができる
      コロンブスの卵的なシステムであり、
      Emacsの日本語入力としてはとても優れたものなのですが、
      一般的なかな漢字変換システムと同じように
      すべての読みを正確に入力しなければならないうえに、
      漢字や送り仮名についてユーザが明示的に指定しなければならないため
      ユーザの負担が大きく、
      どこでも誰でも使えるものとは言い難いものでした。
      
      SKKのようにシンプルでかつ誰でもどこでも使えるような
      入力手法が今後重要になってくるはずです。
      
      GyaimはMac上で動くシンプルで汎用的な日本語入力システムです。
      Gyaimは1000行ほどのRubyで記述されており、
      現在スマホなどでポピュラーになっている
      予測入力と同じように利用することができます。

      Macのアプリケーションは通常は
      Objective-CかSwiftで記述するのが普通ですが、
      ...ごろから
      MacOSのCocoaライブラリを利用できるようにRubyに拡張を加えた
      MacRubyというシステムを使って
      アプリケーション、IME、スクリーンセーバなどを
      Rubyで記述することができるようになっていました。

      MacRubyは無料のシステムだったのですが、
      残念ながら開発が終了してしまい、
      Yosemite以降で使えなってしまいました。
      ところが幸いなことにRubyMotionという別の商用システムが利用できるようになったため、
      YosemiteやEl Capitanでは
      RubyMotionを使ってアプリケーションやIMEを作ることができるようになっており、
      現在最新版のGyaimはRubyMotionを使って実装しています。
      残念ながらRubyMotionはMacRubyと異なりスクリーンセーバ等を作ることはできないようです。

      <h4>MacのIME</h4>

      Unixの実行ファイルのフォーマットはひとつしかありませんが、
      Macの実行プログラムには様々な型式があり、
      通常アプリケーション/スクリーンセーバ/IMEなどの種類により
      異なる型式のBundleを用意しなければなりません。

      たとえばMacのアプリケーションTextEdit.appは
      ...
      のような構造をしています。
      Unixの実行ファイルは
      ....
      ですが、
      インタフェースビルダのファイルや
      いろんなものがまとまって
      TextEdit.appというひとつのディレクトリに格納されています。

      RubyMotionでアプリケーションを作る場合、
      Rubyの実行環境とRubyスクリプトをまとめたものが
      

      IMEを作る場合、
      
      <ul>
	      <li>普通のアプリケーション(e.g. Gyaim.app)を作成する</li>
	      <li>Info.plistをIME用に修正する</li>
	      <li>Gyaim.appを~/Library/Input Methodsに置く</li>
      </ul>
      この後、
      環境設定画面でIMEを選択します。

      IMEではアイコンがあると便利なので、
      またその他の設定も必要だったりするので
      それらをInfo.plistで指定します。

      <h3>Gyaimの実装</h3>
      
      IMEは大まかにいって
      仮名漢字変換アルゴリズムと
      インタフェース
      を用意する必要があります。
      変換アルゴリズムはあらゆるマシンで共通のものを利用できますが、
      インタフェースはマシンごとに用意する必要があります。
      
      
      <h4>IMEインタフェース</h4>
      
      MacにはIMKitというIME作成用ライブラリが用意されており、
      それを利用してIMEを作成することができます。

      Gyaimでは ...handle... というAPIのみを利用しています。

      <h3>かな漢字変換アルゴリズム</h3>

      GyaimではSKKと同様に
      読みと漢字の対応辞書を使ってかな漢字変換を行ないます。

      たとえば日本語入力モードで「とうきょう」と入力されたとき、
      辞書から「とうきょう」という読みをもつ単語を検索してリストして候補として表示し、
      ユーザの操作で候補を選択してテキストに貼り付けます。

      「東京」の後には「駅」や「大学」のような単語が続くことがあります。
      「東京駅」「東京大学」のような単語をすべて辞書に登録しておくのは大変なので、
      「東京は地名である」「地名の後には駅や大学が続くことがある」
      という情報を辞書に登録しておくことにより、
      「東京駅」が辞書に登録されてなくても「とうきょうえき」を「東京駅」に変換できるようにしています。

      同じ手法で動詞の変化形も扱うことができます。
      たとえば辞書に
      「歩」の読みは「ある」である
      「歩」の後にはカ行五段活用語尾がつながる
      「か」はカ行五大活用語尾である
      ...
      のように定義しておけば
      「あるかない」を「歩かない」に変換できます。

      このように、単語の読みと属性、接続情報を定義しておくだけで
      それなりに自然言語を入力することができますし、
      日本語以外の文字入力でも利用できるのが特徴です。
      
      <p/>
      前の単語からの予測機能は実装していませんが、
      簡単に実装することができるでしょう。

<!--
      実際、Google日本語入力のように、
      
新しいアルゴリズムを使った連文節仮名漢字変換システムの開発が続いています。
Google日本語入力システムでは、大規模な文例データ(\idxyomi{コーパス}{こーぱす})に基づいた
\idxyomi{自然言語処理}{しぜんげんごしょり}技術や高度な\idxyomi{圧縮技術}{あっしゅくぎじゅつ}を駆使して
効率の良い入力が可能になっています。
      
      
      Gyaim\url{
  https://github.com/masui/Gyaim
}はMac上で動作するシンプルな予測型日本語入力システムです。
Macでは、標準装備の「\system{ことえり}」や
市販の「\system{ATOK}」のような連文節変換システムが広く使われていますが、
Gyaimは連文節変換を行なわず、
文字を\rensuji{1}文字入力するたびに変換候補を辞書から検索してリストするという方法をとっており、
必要な単語が出たところで入力をやめて候補を選ぶことができるようになっています。
たとえば「\textsf{shinag}」と入力した段階で「品川」を選んで入力することができます。

Gyaimは\idx{MacRuby}というスクリプト言語で実装されています。
MacRubyは汎用スクリプト言語\idx{Ruby}\footnote{
  Rubyは\idx{まつもとゆきひろ}氏が開発したプログラミング言語で、
  現在世界中で広く利用されています。
}をMac用に拡張したシステムで、
Rubyのすべての機能を利用できることに加え、
全てのMacのライブラリを利用することができます。
Macのアプリケーション開発は\idx{Objective-C}を利用するのが普通ですが、
Rubyは文字列処理を簡単に行なうことができるので、
Gyaimはわずか数百行で実装されています。
-->

      
    </div>
  </body>
</html>

