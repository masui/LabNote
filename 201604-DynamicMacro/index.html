<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>コロンブス日和 - DynamicMacro</title>
    <style type="text/css">
      body { background-color: #fff; font-size:12; font-family: "Hiragino Kaku Gothic ProN","メイリオ", sans-serif;}
      a { text-decoration: none; }
      li.bold { font-weight: bold; }
      div.body { width:340pt; }
      div.left { float:left; width:10%; font-weight:bold;}
      div.right { width:50%;}
    </style>
  </head>

  <body>
    <div class='body'>

      <h1>コロンブス日和 - DynamicMacro</h1>

      同じ作業を何度も繰り返さなければならないことがよくあります。
      計算機は単純な繰り返し作業が得意なはずですが、
      
      <p/>
      予測インタフェースと呼ばれている
      ケータイの予測入力も予測インタフェースの一種ですし、
      ブラウザのURL補完機能やエディタの補完機能も一種の予測インタフェースです。
      
      予測インタフェースを実現するためには
      予測を行なうためのデータベースが必要になります。
      
      URL補完の場合はよく使われるURLのデータベースがあれば便利ですし、
      プログラミング言語に関する情報を持っていればユーザの次の入力を予測できます。
      
      最初からデータベースを用意しておくことも重要ですが、
      ユーザの操作履歴をデータベースとして利用するのも便利です。
      
      一度訪れたサイトのURLを記録しておいて補完に利用されていますし、
      予測入力システムでは一度選択的した単語やフレーズが次の予測に利用されるのが普通です。
      
      <h2>繰り返される作業からの予測</h2>
      
      文章やプログラムを編集するとき、コメント
      
      例えば、連続する行の先頭に記号を入れたいような場合、
      カーソルを1行ずつ動かして記号を入れるのは面倒です。
      行頭に記号を挿入するプログラムを動かせば良いのかもしれませんが
      
      csvデータの桁を入れ替えたいときはどうするでしょうか?
      データを読み取ってから新しい並べで出力すれようなプログラムを使えば良いかもしれませんが、
      わざわざそれだけのためにプログラムを書くのは面倒です。
      
      このような場合のために「キーボードマクロ」という機能が用意されているエディタがあります。
      キーボードマクロとは、一連のエディタ操作をひとつのキーに割り当てることにより、
      複雑な編集操作を楽に実行しようというものです。
      
      例えば「行頭に記号を挿入してからひとつ下の行に移動する」という処理を
      Aというキーに割り当てておけば、
      Aを連打することによって連続行の行頭に記号を入力していくことができますし、
      「カンマで区切られた部分を選択して移動してから次の行に移動する」という処理を
      Bというキーに割り当てておけば、
      Bを連打することによってcsvの桁を入れ替えていくことができます。
      
      キーボードマクロは便利な機能なのですが、
      「キーボードマクロの定義を開始する」「キーボードマクロの定義を終了する」
      という二つの操作が必要ですし、
      操作の定義を間違えやすいという問題もあります。
      たとえば前述の例の場合、「ひとつ下の行に移動する」処理を定義に含めることを忘れてしまうと
      正しく動きません。
      
      <h2>Dynamic Macro</h2>
      
      キーボードマクロの機能をもっと簡単に使えるようにするため、私は
      Dynamic Macro
      というシステムを利用しています。
      Dynamic Macroの原理は非常に単純で、
      
      「同じ編集操作を2回繰り返した後で「繰り返しキー」を押すと繰り返された操作が再実行される」
      
      というものです。
      
      Dynamic Macroは
      予測インタフェースの考え方を
      キーボードマクロに応用したものだといえます。
      
      キーボードマクロと比較すると以下のような利点があります。
      
      <ul>
        <li>必要なキーはひとつだけ</li>
        <li>定義する操作の開始と終了を指定する必要がない</li>
        <li>操作を行なった後で繰り返し実行を指示できる</li>
      </ul>
      
      <h3>EmacsのDynamic Macro</h3>
      
      Emacsでは<code>(recent-keys)</code>という関数を使って
      最近のキー操作履歴を知ることができます。
      
      繰り返しキーが押されたとき recent-keys を使ってキー操作履歴を取得し、
      繰り返し操作がみつかれば
      それをキーボードマクロとして登録して実行すればよいことになります。
      
      (実行例)
      
      dmacro.elを改良した
      ndmacro.el
      というものが公開されています。
      
      ndmacro.elでは
      1, 2, 3 と入力した後で
      
      
      (実行例)
      
      <h3>AtomのDynamic Macro</h3>
      
      GitHubが開発しているAtomというエディタが
      プログラマの間で人気になっています。
      AtomはJavaScriptベースのElectron上に作成された高機能なエディタで、
      ユーザが自由にJavaScriptやCoffeeScriptで拡張機能を作成することができます。
      
      <blockquote>
        <img src="https://gyazo.com/ec188b77ca139f65ff4890105e0cb78a.png" width=300/>
      </blockquote>
      

      <hr>
      私は1980年代からずっとEmacsを利用しており、
      1990年代からDynamic Macroを使い続けており、
      Dynamic Macroが使えないエディタは考えられない状況でした。
      最近AtomでDynamic Macroが動くようになったので、
      これからAtomを利用するようにしようかと考えています。
      この原稿もAtomで書いています。
      
      AtomではHTMLやMarkDownをリアルタイムにプレビューできるところが
      便利ですし、いざとなればJavaScriptで自由に機能を変えられるところは
      プログラマにとって魅力的です。
      また、新しいエディタなので
      GUI対応も充分ですから
      プログラマ以外にも充分薦められるように思います。

    </div>
  </body>
</html>

